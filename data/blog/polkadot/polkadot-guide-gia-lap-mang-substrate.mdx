---
title: 'Polkadot Guide: Giáº£ láº­p máº¡ng Substrate'
date: '2023-12-3'
authors: ['1-tin-chung']
tags: ['technical', 'blockchain', 'polkadot', 'substrate', 'beginner', 'lang-vn']
draft: false
summary: HÆ°á»›ng dáº«n cháº¡y máº¡ng Substrate riÃªng tÆ° káº¿t ná»‘i vá»›i cÃ¡c node ngang hÃ ng vÃ  phÃ¢n quyá»n cá»¥ thá»ƒ cho tá»«ng node
---

_Language_: Vietnamese

_Cáº¥p Ä‘á»™_: Begineer

# Polkadot Guide: Giáº£ láº­p máº¡ng Substrate

## BÃ i viáº¿t liÃªn quan

- [Substrate Tutorial - Authorize specific nodes](https://docs.substrate.io/tutorials/build-a-blockchain/authorize-specific-nodes/)
- [Substrate Tutorial - Simulate a network](https://docs.substrate.io/tutorials/build-a-blockchain/simulate-network/)
- [Polkadot - Set up a Bootnode](https://wiki.polkadot.network/docs/maintain-bootnode)
- [Polkadot Host - Block production](https://spec.polkadot.network/sect-block-production)

## MiÃªu táº£

Trong bÃ i viáº¿t nÃ y, chÃºng ta sáº½ Ä‘i qua hÆ°á»›ng dáº«n Ä‘á»ƒ thiá»‡t láº­p private network báº±ng `substrate-node-template` vá»›i cÃ¡c `validators` Ä‘Æ°á»£c khai bÃ¡o trong cÃ¡c `authority set` (táº­p há»£p cÃ¡c bÃªn Ä‘Æ°á»£c uá»· quyá»n). Nhiá»‡m vá»¥ cá»§a cÃ¡c `authorized accounts` (tÃ i khoáº£n Ä‘Æ°á»£c uá»· quyá»n) lÃ  tham gia vÃ o quÃ¡ tÃ¬nh sáº£n sinh block (`block production`).

> [Block production (sáº£n sinh block)](https://spec.polkadot.network/sect-block-production): LÃ  má»™t quy trÃ¬nh quan trá»ng trong báº¥t kÃ¬ máº¡ng blockchain nÃ o. NhÆ° tÃªn gá»i cá»§a cÃ´ng nghá»‡ "Block" vÃ  "chain", mang nghÄ©a má»™t chuá»—i cÃ¡c khá»‘i liÃªn káº¿t vá»›i nhau Ä‘á»ƒ duy trÃ¬ tráº¡ng thÃ¡i cá»§a toÃ n bá»™ máº¡ng lÆ°á»›i.
>
> CÃ¡c `block producer` - cÃ¡c node Ä‘Æ°á»£c uá»· quyá»n trong Polkadot Host - Ä‘Ã³ng vai trÃ² sáº£n sinh block trong máº¡ng Polkadot. Trong máº¡ng Polkadot, giao thá»©c `BABE` Ä‘Æ°á»£c sá»­ dá»¥ng cho viá»‡c sáº£n sinh block.

Äá»ƒ cÃ³ má»™t cÃ¡i nhÃ¬n trá»±c quan vá» bÃ i viáº¿t nÃ y, báº¡n cÃ³ thá»ƒ tham kháº£o bÃ i viáº¿t [Substrate Tutorial - Authorize specific nodes](https://docs.substrate.io/tutorials/build-a-blockchain/authorize-specific-nodes/) vá» viá»‡c uá»· quyá»n `nodes` trong máº¡ng Substrate

## Má»¥c tiÃªu cá»§a bÃ i viáº¿t

- Cháº¡y blockchain node báº±ng `substrate-node-template` vá»›i cÃ¡c `account` Ä‘Ã£ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh tá»« trÆ°á»›c
- CÃ¡ch xÃ¡c Ä‘á»‹nh xem node Ä‘Ã£ cháº¡y vÃ  báº¯t Ä‘áº§u sáº£n sinh `block`
- Káº¿t ná»‘i nhiá»u node ngang hÃ ng trong cÃ¹ng máº¡ng lÆ°á»›i vá»›i nhau

## Cháº¡y blockchain node Ä‘áº§u tiÃªn

TrÆ°á»›c khi Ä‘i sÃ¢u hÆ¡n á»Ÿ cÃ¡c pháº§n sau cá»§a bÃ i viáº¿t. Báº¡n hÃ£y xem qua trÆ°á»›c bÃ i viáº¿t vá» [Polkadot Guide: Cháº¡y Substrate node trÃªn mÃ¡y tÃ­nh cá»§a báº¡n](https://lowlevelers.com/blog/polkadot/polkadot-guide-chay-local-substrate-node)vÃ  cháº¯c cháº¯n ráº±ng báº¡n Ä‘Ã£ cÃ³ thá»ƒ Ã­t nháº¥t cháº¡y Ä‘Æ°á»£c má»™t node Ä‘Æ¡n láº». á» Ä‘Ã¢y mÃ¬nh sáº½ cháº¡y node Ä‘áº§u tiÃªn sá»­ dá»¥ng má»™t `account` Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh sáºµn lÃ  `alice`

```shell
./target/release/node-template \
--chain local \
--base-path /tmp/validator1 \
--alice \ Â  Â 
--node-key=c12b6d18942f5ee8528c8e2baf4e147b5c5c18710926ea492d09cbd9f6c9f82a \
--port 30333 \
--rpc-port 9944
```

CÃ¢u lá»‡nh nÃ y sáº½ cháº¡y Substrate Node táº¡i `port = 3033` vÃ  `rpc-port = 9944` chá»©a key cá»§a account `alice`, tráº¡ng thÃ¡i cá»§a node sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i `/tmp/validator1` cÃ¹ng vá»›i `node-key` Ä‘Æ°á»£c khai bÃ¡o.

![fig](/static/images/polkadot/simulate-first-node-status.png)

Káº¿t quáº£ sau tá»« hÆ°á»›ng dáº«n phÃ­a trÃªn sáº½ lÃ  má»™t sá»‘ tráº¡ng thÃ¡i mÃ  báº¡n cÃ³ thá»ƒ quan sÃ¡t tháº¥y má»™t sá»‘ thÃ´ng tin tráº¡ng thÃ¡i quan trá»ng cá»§a node hiá»‡n táº¡i

### Tráº¡ng thÃ¡i 1: Genesis block

```
ğŸ”¨ Initializing Genesis block/state (state: 0x0c52â€¦6b91, header-hash: 0xfc58â€¦cdc4)
```

Khá»Ÿi táº¡o block Ä‘áº§u tiÃªn (genesis block) khi node Ä‘Æ°á»£c cháº¡y. Äá»ƒ xÃ¡c Ä‘á»‹nh 2 node ngang hÃ ng Ä‘ang cÃ¹ng cháº¡y trÃªn 1 máº¡ng blockchain, báº¡n cÃ³ thá»ƒ kiá»ƒm tra xem giÃ¡ trá»‹ cá»§a `genesis block` cÃ³ giá»‘ng nhau á»Ÿ cáº£ 2 node hay khÃ´ng.

> Genesis block lÃ  khá»‘i Ä‘áº§u tiÃªn Ä‘Æ°á»£c khá»Ÿi táº¡o trong má»™t máº¡ng blockchain

### Tráº¡ng thÃ¡i 2: Danh tÃ­nh cá»§a node (Node identity)

```
ğŸ·Â  Local node identity is: 12D3KooWBmAwcd4PJNJvfV89HwE48nwkRmAgo8Vy3uQEyNNHBox2
```

ÄÃ¢y lÃ  mÃ£ Ä‘á»‹nh danh cá»§a node trong máº¡ng lÆ°á»›i blockchain. Má»—i node tham gia vÃ o máº¡ng lÆ°á»›i Ä‘á»u pháº£i mang má»™t danh tÃ­nh Ä‘á»™c nháº¥t. Náº¿u 2 node máº¡ng cÃ¹ng mÃ£ Ä‘á»‹nh danh sáº½ dáº«n Ä‘áº¿n xung Ä‘á»™t trong quÃ¡ trÃ¬nh xÃ¡c thá»±c vÃ  sáº£n sinh block.

### Tráº¡ng thÃ¡i 3: Block production

```
ğŸ’¤ Idle (0 peers), best: #0 (0xfc58â€¦cdc4), finalized #0 (0xfc58â€¦cdc4), â¬‡ 0 â¬† 0
```

á» Ä‘Ã¢y báº¡n cÃ³ thá»ƒ tháº¥y node hiá»‡n táº¡i Ä‘ang trong tráº¡ng thÃ¡i nghá»‰ `Idle` vá»›i `best` hiá»ƒn thá»‹ block height cao nháº¥t Ä‘Æ°á»£c sáº£n sinh nhÆ°ng chÆ°a

## ThÃªm Node thá»© 2 vÃ o máº¡ng lÆ°á»›i

```shell
./target/release/node-template \Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
--chain=local \
--base-path /tmp/validator2 \
--bob \ Â  Â  Â  Â  Â 
--node-key=6ce3be907dbcabf20a9a5a60a712b4256a54196000a8ed4050d352bc113f8c58 \
--bootnodes /ip4/127.0.0.1/tcp/30333/p2p/12D3KooWBmAwcd4PJNJvfV89HwE48nwkRmAgo8Vy3uQEyNNHBox2 \ Â 
--port 30334 \ Â  Â  Â  Â  Â 
--rpc-port 9945
```

CÃ¢u lá»‡nh nÃ y sáº½ cháº¡y Substrate Node táº¡i `port = 30334` vÃ  `rpc-port = 9945` (vÃ¬ cáº£ 2 node Ä‘Æ°á»£c cháº¡y trong local network vÃ  node `alice` Ä‘Ã£ cháº¡y á»Ÿ port `30333:9944`, node `bob` pháº£i cháº¡y á»Ÿ má»™t port khÃ¡c Ä‘á»ƒ khÃ´ng xáº£y ra xung Ä‘á»™t) chá»©a key cá»§a account `bob`, tráº¡ng thÃ¡i cá»§a node sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i `/tmp/validator2` cÃ¹ng vá»›i `node-key` Ä‘Æ°á»£c khai bÃ¡o.

NgoÃ i ra, chÃºng ta pháº£i khai bÃ¡o thÃªm `bootnodes`

> Bootnode lÃ  node Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ tÃ¬m kiáº¿m cÃ¡c node khÃ¡c. Trong má»™t máº¡ng private network, cáº§n Ã­t nháº¥t khai bÃ¡o má»™t bootnode. Bootnode lÃ  node Ä‘Ã£ káº¿t ná»‘i vÃ o máº¡ng blockchain.
>
> Hiá»ƒu theo má»™t cÃ¡ch khÃ¡c, Bootnode cÃ³ thá»ƒ Ä‘Æ°á»£c xem nhÆ° cÃ¡c tráº¡m phÃ¡t sÃ³ng.

Sau khi cháº¡y cÃ¢u lá»‡nh á»Ÿ trÃªn Ä‘á»ƒ khá»Ÿi táº¡o node thá»© hai, báº¡n sáº½ tháº¥y cÃ¡c tráº¡ng thÃ¡i sau

```zsh
2023-12-08 15:59:31 Substrate Node Â  Â 
2023-12-08 15:59:31 âœŒï¸Â  version 4.0.0-dev-41ad4a6c9d7 Â  Â 
2023-12-08 15:59:31 â¤ï¸Â  by Substrate DevHub <https://github.com/substrate-developer-hub>, 2017-2023 Â  Â 
2023-12-08 15:59:31 ğŸ“‹ Chain specification: Local Testnet Â  Â 
2023-12-08 15:59:31 ğŸ·Â  Node name: Bob Â  Â 
2023-12-08 15:59:31 ğŸ‘¤ Role: AUTHORITY Â  Â 
2023-12-08 15:59:31 ğŸ’¾ Database: RocksDb at /tmp/validator2/chains/local_testnet/db/full Â  Â 
2023-12-08 15:59:31 ğŸ”¨ Initializing Genesis block/state (state: 0x0c52â€¦6b91, header-hash: 0xfc58â€¦cdc4) Â  Â 
2023-12-08 15:59:31 ğŸ‘´ Loading GRANDPA authority set from genesis on what appears to be first startup. Â 
2023-12-08 15:59:31 Using default protocol ID "sup" because none is configured in the chain specs Â  Â 
2023-12-08 15:59:31 ğŸ·Â  Local node identity is: 12D3KooWQYV9dGMFoRzNStwpXztXaBUjtPqi6aU76ZgUriHhKust Â  Â 
2023-12-08 15:59:31 ğŸ’» Operating system: macos Â  Â 
2023-12-08 15:59:31 ğŸ’» CPU architecture: aarch64 Â  Â 
2023-12-08 15:59:31 ğŸ“¦ Highest known block at #0 Â  Â 
2023-12-08 15:59:31 Running JSON-RPC server: addr=127.0.0.1:9945, allowed origins=["http://localhost:*", "http://127.0.0.1:*", "https://localhost:*", "https://127.0.0.1:*", "https://polkadot.js.org"] Â  Â 
2023-12-08 15:59:31 discovered: 12D3KooWBmAwcd4PJNJvfV89HwE48nwkRmAgo8Vy3uQEyNNHBox2 /ip4/172.16.1.243/tcp/30333
```

### Kiá»ƒm tra tráº¡ng thÃ¡i cá»§a Genesis block

NhÆ° mÃ¬nh Ä‘Ã£ Ä‘á» cáº­p á»Ÿ trÃªn, Ä‘á»ƒ kiá»ƒm tra xem 2 node Ä‘Ã£ cÃ¹ng má»™t blockchain hay chÆ°a, báº¡n cÃ³ thá»ƒ xem thÃ´ng tin cá»§a `genesis block`

```
ğŸ”¨ Initializing Genesis block/state (state: 0x0c52â€¦6b91, header-hash: 0xfc58â€¦cdc4) Â  Â 
```

Váº­y lÃ  genesis block giá»‘ng nhau á»Ÿ cáº£ hai node, váº­y lÃ  2 node ngang hÃ ng Ä‘Ã£ Ä‘Æ°á»£c káº¿t ná»‘i.

### XÃ¡c Ä‘á»‹nh node Ä‘Ã£ Ä‘Æ°á»£c tÃ¬m tháº¥y

NgoÃ i cÃ¡c thÃ´ng tin giá»‘ng vá»›i giáº£i thÃ­ch á»Ÿ pháº§n trÃªn, báº¡n cÃ³ thá»ƒ tháº¥y thÃªm tráº¡ng thÃ¡i miÃªu táº£ ráº±ng Ä‘Ã£ tÃ¬m tháº¥y `node` thá»© nháº¥t

```
discovered: 12D3KooWBmAwcd4PJNJvfV89HwE48nwkRmAgo8Vy3uQEyNNHBox2 /ip4/172.16.1.243/tcp/30333
```

### XÃ¡c Ä‘á»‹nh quÃ¡ trÃ¬nh sáº£n sinh block Ä‘Ã£ báº¯t Ä‘áº§u

LÃºc nÃ y, chÃºng ta sáº½ quan sÃ¡t tráº¡ng thÃ¡i sáº£n sinh block thay Ä‘á»•i

```zsh
2023-12-08 15:59:38 ğŸ™Œ Starting consensus session on top of parent 0xd2915610203843a2b73e52b3f1fe07acdb1b143af9d8109c5865ef7dc31544fd Â  Â 
2023-12-08 15:59:38 ğŸ Prepared block for proposing at 4 (0 ms) [hash: 0xc0cd680856b8e2b36760b75f8818c7062adffe4b780b351cef7af6a1d979ea64; parent_hash: 0xd291â€¦44fd; extrinsics (1): [0x4532â€¦44d3] Â  Â 
2023-12-08 15:59:38 ğŸ”– Pre-sealed block for proposal at 4. Hash now 0xdb2ada225001905a569d2fbf1b35feda3725fd66415fcad2f1d25c1079dbbdf6, previously 0xc0cd680856b8e2b36760b75f8818c7062adffe4b780b351cef7af6a1d979ea64. Â  Â 
2023-12-08 15:59:38 âœ¨ Imported #4 (0xdb2aâ€¦bdf6) Â  Â 
2023-12-08 15:59:40 âœ¨ Imported #5 (0xf4e2â€¦43e9) Â  Â 
2023-12-08 15:59:41 ğŸ’¤ Idle (1 peers), best: #5 (0xf4e2â€¦43e9), finalized #3 (0xd291â€¦44fd), â¬‡ 0.7kiB/s â¬† 0.7kiB/s
```

TÃ¬m tháº¥y node ngang hÃ ng `(1 peers)` vÃ  block Ä‘Æ°á»£c sáº£n sinh vÃ  `finalized`

```
2023-12-08 15:59:41 ğŸ’¤ Idle (1 peers), best: #5 (0xf4e2â€¦43e9), finalized #3 (0xd291â€¦44fd), â¬‡ 0.7kiB/s â¬† 0.7kiB/s
```

### Thá»­ nghiá»‡m cháº¡y node thá»© 3

Váº­y lÃ  báº¡n Ä‘Ã£ thÃ nh cÃ´ng trong giáº£ láº­p láº¡i má»™t private network cháº¡y báº±ng `substrate-node-template`. ChÃºng ta sáº½ thá»­ nghiá»‡m má»™t chÃºt báº±ng viá»‡c cháº¡y node thá»© 3 `charlie`.

```zsh
./target/release/node-template \Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
--chain=local \
--base-path /tmp/validator3 \
--name charlieÂ  \
--node-key=3a9d5b35b9fb4c42aafadeca046f6bf56107bd2579687f069b42646684b94d9e \
--port 30335 \
--rpc-port=9946 \
--offchain-worker always
```

VÃ  Ä‘Ã¢y lÃ  káº¿t quáº£ tráº¡ng thÃ¡i mÃ¬nh nháº­n Ä‘Æ°á»£c. Báº¡n cÃ³ thá»ƒ tháº¥y node `charlie` Ä‘Ã£ tÃ¬m tháº¥y node `alice` vÃ  `bob` thÃ´ng qua bootnode lÃ  `alice`. CÃ¡c node sáº½ Ä‘Æ°á»£c nháº­p vÃ o blockchain node `charlie`. Sá»‘ peer lÃºc nÃ y tÄƒng lÃªn 2.

```
2023-12-08 16:44:17 discovered: 12D3KooWF2rGjhfhV8c93wZM9SAUeMTmcuh6GRSeRcqqbHT8Pwpq /ip4/172.16.1.243/tcp/30334 Â  Â 
2023-12-08 16:44:17 discovered: 12D3KooWSaDfHMHYYLNMDMfb1CHAufuL4BHsJ4UdhT5Rh5aAnV98 /ip4/172.16.1.243/tcp/30333 Â  Â 
2023-12-08 16:44:17 âœ¨ Imported #1 (0x73a4â€¦5a35) Â  Â 
2023-12-08 16:44:17 âœ¨ Imported #2 (0x2da1â€¦10fe) Â  Â 
2023-12-08 16:44:17 âœ¨ Imported #3 (0xbba6â€¦5be5) Â  Â 
2023-12-08 16:44:17 âœ¨ Imported #4 (0x9cf6â€¦1fc7) Â  Â 
2023-12-08 16:44:18 âœ¨ Imported #5 (0x12c3â€¦806a) Â  Â 
2023-12-08 16:44:22 ğŸ’¤ Idle (2 peers), best: #5 (0x12c3â€¦806a), finalized #3 (0xbba6â€¦5be5), â¬‡ 2.9kiB/s â¬† 2.3kiB/s
```

### Quan sÃ¡t thÃ´ng sá»‘ trÃªn polkadot.js.org

Sau khi cÃ³ private network cháº¡y thÃ nh cÃ´ng, chÃºng ta cÃ³ thá»ƒ xem Ä‘Æ°á»£c hoáº¡t Ä‘á»™ng cá»§a máº¡ng lÆ°á»›i vÃ  tÆ°Æ¡ng tÃ¡c thÃ´ng qua https://polkadot.js.org/apps. Báº¡n chá»‰ cáº§n káº¿t ná»‘i tá»›i 1 tá»ng cÃ¡c RPC port mÃ  báº¡n Ä‘Ã£ cÃ i Ä‘áº·t cho node tá»« trÆ°á»›c nhÆ° lÃ  `9944` hoáº·c `9945`.

![fig](/static/images/polkadot/simulate-polkadot-js-org.png)
